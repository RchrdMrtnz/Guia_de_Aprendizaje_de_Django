<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>17. Dashboard ERP - Gu칤a Django</title>
    <meta name="description" content="Aprende a construir Dashboards ERP profesionales con Django: Analytics, Reportes PDF, Gr치ficos, Exportaci칩n de Datos y Optimizaci칩n de Consultas.">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com?plugins=typography,forms"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        brand: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            900: '#1e3a8a',
                        }
                    }
                }
            }
        }
    </script>

    <!-- PrismJS for Syntax Highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />

    <style>
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #1f2937; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #374151; border-radius: 3px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #4b5563; }
        pre[class*="language-"] { border-radius: 0.5rem; margin: 1.5rem 0; }

        /* Custom Panels */
        .deep-dive { border-left: 4px solid #8b5cf6; padding-left: 1.5rem; margin-top: 2rem; margin-bottom: 2rem; background-color: rgba(139, 92, 246, 0.05); padding: 1.5rem; border-radius: 0 0.5rem 0.5rem 0; }
        .security-alert { border-left: 4px solid #ef4444; background-color: rgba(239, 68, 68, 0.1); padding: 1rem; border-radius: 0.5rem; }
        .pro-tip { border-left: 4px solid #10b981; background-color: rgba(16, 185, 129, 0.1); padding: 1rem; border-radius: 0.5rem; }
        .architecture-note { border-left: 4px solid #f59e0b; background-color: rgba(245, 158, 11, 0.1); padding: 1rem; border-radius: 0.5rem; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 antialiased dark:bg-gray-900 dark:text-gray-100">

    <!-- Mobile Header -->
    <div class="lg:hidden flex items-center justify-between p-4 bg-gray-900 text-white sticky top-0 z-50 shadow-md">
        <span class="font-bold text-lg">Django Gu칤a</span>
        <button id="mobile-menu-toggle" class="p-2 focus:outline-none">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
            </svg>
        </button>
    </div>

    <!-- Sidebar Overlay (Mobile) -->
    <div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden lg:hidden transition-opacity"></div>

    <!-- Sidebar -->
    <aside id="default-sidebar" class="fixed top-0 left-0 z-40 w-64 h-screen transition-transform -translate-x-full lg:translate-x-0 bg-gray-900 border-r border-gray-800" aria-label="Sidebar">
        <div class="h-full flex flex-col">
            <div class="p-6 border-b border-gray-800">
                <a href="index.html" class="flex items-center space-x-3 rtl:space-x-reverse">
                    <span class="self-center text-xl font-bold whitespace-nowrap text-white">Django Gu칤a</span>
                </a>
                <p class="text-xs text-gray-500 mt-2">Dominando el framework web para perfeccionistas.</p>
            </div>
            <div class="px-3 py-4 overflow-y-auto flex-1 custom-scrollbar" id="sidebar-content">
                <!-- Javascript will inject menu here -->
            </div>
            <div class="p-4 border-t border-gray-800">
                <a href="https://github.com/RchrdMrtnz/Guia_de_Aprendizaje_de_Django" target="_blank" class="flex items-center p-2 text-gray-400 rounded-lg hover:text-white hover:bg-gray-800 group transition-colors">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd"></path></svg>
                    <span class="ml-3 text-sm">Ver en GitHub</span>
                </a>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <div class="p-4 lg:ml-64 min-h-screen">
        <div class="p-4 lg:p-8 max-w-5xl mx-auto">
            <main class="prose prose-slate prose-lg max-w-none prose-headings:text-gray-900 dark:prose-headings:text-gray-100 dark:prose-p:text-gray-300 dark:prose-strong:text-white dark:prose-li:text-gray-300 prose-a:text-blue-600 hover:prose-a:text-blue-800 prose-pre:bg-gray-800 prose-pre:shadow-lg rounded-xl">

                <h1 class="text-4xl font-extrabold mb-8 text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-cyan-500">
                    17. Dashboard ERP: Construyendo Sistemas de Gesti칩n
                </h1>

                <p class="lead text-xl text-gray-600 dark:text-gray-400">
                    Desarrollar un Dashboard ERP (Enterprise Resource Planning) implica mucho m치s que simplemente mostrar datos en pantalla. Se trata de crear una herramienta de toma de decisiones que sea r치pida, segura y capaz de manejar grandes vol칰menes de informaci칩n. En este cap칤tulo, nos centraremos en la arquitectura de backend, la optimizaci칩n de bases de datos para an치lisis, y la integraci칩n de herramientas de reporte profesional.
                </p>

                <!-- INDICE RAPIDO -->
                <div class="bg-gray-100 dark:bg-gray-800 p-6 rounded-lg my-8 border border-gray-200 dark:border-gray-700">
                    <h3 class="mt-0 mb-4 text-sm font-bold uppercase tracking-wide text-gray-500">Contenido del Cap칤tulo</h3>
                    <ul class="grid grid-cols-1 md:grid-cols-2 gap-2 text-sm">
                        <li><a href="#arquitectura" class="no-underline hover:text-blue-600">游댳 1. Arquitectura de Dashboards</a></li>
                        <li><a href="#analytics-db" class="no-underline hover:text-blue-600">游댳 2. Dise침o de DB para Analytics</a></li>
                        <li><a href="#optimizacion" class="no-underline hover:text-blue-600">游댳 3. Optimizaci칩n de Consultas</a></li>
                        <li><a href="#chartjs" class="no-underline hover:text-blue-600">游댳 4. Visualizaci칩n con Chart.js</a></li>
                        <li><a href="#htmx-tables" class="no-underline hover:text-blue-600">游댳 5. Tablas Din치micas (HTMX)</a></li>
                        <li><a href="#pdf-weasyprint" class="no-underline hover:text-blue-600">游댳 6. Reportes PDF (WeasyPrint)</a></li>
                        <li><a href="#exportacion" class="no-underline hover:text-blue-600">游댳 7. Exportaci칩n Masiva (Excel/CSV)</a></li>
                        <li><a href="#cache" class="no-underline hover:text-blue-600">游댳 8. Estrategias de Cach칠</a></li>
                        <li><a href="#seguridad" class="no-underline hover:text-blue-600">游댳 9. Seguridad Multitenant</a></li>
                        <li><a href="#ui-ux" class="no-underline hover:text-blue-600">游댳 10. UI/UX para Alta Densidad</a></li>
                    </ul>
                </div>

                <!-- 1. ARQUITECTURA -->
                <h2 id="arquitectura" class="text-3xl border-b pb-2">1. Arquitectura de Dashboards (MVC & Servicios)</h2>
                <p>
                    Un error com칰n al construir dashboards en Django es colocar l칩gica compleja de agregaci칩n directamente en las Vistas o, peor a칰n, en los Templates. La arquitectura ideal para un ERP separa claramente las responsabilidades. Las Vistas deben actuar estrictamente como controladores que orquestan la petici칩n, delegan el procesamiento de datos a una <strong>Capa de Servicios</strong> o a <strong>Selectores</strong> especializados, y retornan un contexto limpio. Para un Dashboard, esto significa tener clases de servicio como `SalesAnalyticsService` o `InventoryReportService` que encapsulen m칠todos como `get_monthly_revenue()` o `calculate_churn_rate()`. Esto no solo hace que el c칩digo sea testeable de forma aislada (sin necesidad de mocks complejos de request/response), sino que permite reutilizar estas m칠tricas en tareas as칤ncronas (Celery) o comandos de gesti칩n sin duplicar la l칩gica de negocio.
                </p>

                <!-- 2. DISE칌O DB ANALYTICS -->
                <h2 id="analytics-db" class="text-3xl border-b pb-2">2. Dise침o de Bases de Datos para Analytics</h2>
                <p>
                    Los modelos relacionales normalizados (3NF) son excelentes para la integridad transaccional (OLTP), pero pueden ser ineficientes para consultas anal칤ticas (OLAP) que requieren sumarizar millones de registros. En un entorno ERP, a menudo es necesario implementar estrategias h칤bridas. Esto puede incluir la creaci칩n de <strong>Vistas Materializadas</strong> (soportadas nativamente por PostgreSQL) que pre-calculan agregaciones complejas y se refrescan peri칩dicamente. Otra t칠cnica es la desnormalizaci칩n controlada, donde se almacenan totales calculados en el modelo padre (ej. `total_ventas` en el modelo `Cliente`) y se actualizan mediante se침ales o transacciones at칩micas. Entender cu치ndo romper la normalizaci칩n para ganar rendimiento en lectura es una habilidad cr칤tica para el arquitecto de software que dise침a sistemas de alto tr치fico.
                </p>

                <!-- 3. OPTIMIZACION CONSULTAS -->
                <h2 id="optimizacion" class="text-3xl border-b pb-2">3. Optimizaci칩n de Consultas (ORM Avanzado)</h2>
                <p>
                    El problema "N+1" es el enemigo n칰mero uno del rendimiento en dashboards. Ocurre cuando Django ejecuta una consulta SQL adicional por cada objeto en un bucle (por ejemplo, acceder a `venta.cliente.nombre` dentro de un loop de ventas). Para evitar esto, es obligatorio dominar `select_related()` (para relaciones ForeignKey/OneToOne) y `prefetch_related()` (para ManyToMany/Reverse FK). Adem치s, para m칠tricas, el uso de `.annotate()` y `.aggregate()` permite realizar c치lculos de suma, promedio y conteo directamente en la base de datos, lo cual es 칩rdenes de magnitud m치s r치pido que traer todos los objetos a Python y sumarlos en memoria. Herramientas como `django-debug-toolbar` o `silk` son indispensables para auditar y perfilar estas consultas durante el desarrollo.
                </p>
                <pre><code class="language-python"># Malo: N+1 queries, c치lculo en Python
ventas = Venta.objects.all()
total = sum(v.monto for v in ventas)

# Bueno: 1 query, c치lculo en DB
from django.db.models import Sum
total = Venta.objects.aggregate(Sum('monto'))['monto__sum']
</code></pre>

                <!-- 4. VISUALIZACION CHART.JS -->
                <h2 id="chartjs" class="text-3xl border-b pb-2">4. Visualizaci칩n de Datos con Chart.js</h2>
                <p>
                    Renderizar gr치ficos interactivos requiere pasar datos del backend (Python) al frontend (JavaScript) de manera segura. Chart.js es el est치ndar de la industria por su flexibilidad y rendimiento en canvas HTML5. La forma correcta de integrar esto en Django no es concatenando strings en el template, lo cual es vulnerable a XSS, sino utilizando el filtro `json_script`. Este filtro serializa los datos de Python a JSON y los coloca en una etiqueta `&lt;script&gt;` con un ID espec칤fico. Luego, en tu archivo JavaScript, puedes parsear este contenido de forma segura. Esto desacopla la l칩gica de obtenci칩n de datos de la l칩gica de renderizado visual, permitiendo que dise침adores frontend trabajen en la configuraci칩n del gr치fico sin tocar el c칩digo Python.
                </p>

                <!-- 5. TABLAS DINAMICAS HTMX -->
                <h2 id="htmx-tables" class="text-3xl border-b pb-2">5. Tablas Din치micas con HTMX</h2>
                <p>
                    Las tablas de datos en un ERP moderno deben permitir filtrado, ordenamiento y paginaci칩n sin recargar la p치gina completa. Tradicionalmente, esto requer칤a construir una API REST completa y un frontend complejo en React/Vue. Con <strong>HTMX</strong>, podemos lograr esto manteniendo el renderizado en el servidor. Al interceptar los eventos de clic en los encabezados de columna o en la paginaci칩n, HTMX solicita al servidor solo el HTML parcial de las nuevas filas de la tabla y reemplaza el contenido del cuerpo de la tabla (`<tbody>`). Esto reduce dr치sticamente la complejidad del desarrollo, elimina la necesidad de sincronizar estado entre cliente y servidor, y mejora el tiempo de primera pintura (First Contentful Paint) al enviar HTML listo para ser visualizado.
                </p>

                <!-- 6. REPORTES PDF WEASYPRINT -->
                <h2 id="pdf-weasyprint" class="text-3xl border-b pb-2">6. Reportes PDF Profesionales (WeasyPrint)</h2>
                <p>
                    La generaci칩n de documentos inmutables como facturas, 칩rdenes de compra y reportes fiscales es un requisito no negociable en sistemas ERP. <strong>WeasyPrint</strong> es la herramienta predilecta en el ecosistema Python porque permite dise침ar estos documentos utilizando HTML y CSS est치ndar, incluyendo soporte para Paged Media (paginaci칩n, encabezados y pies de p치gina repetidos). A diferencia de librer칤as antiguas como ReportLab que requer칤an "dibujar" el PDF program치ticamente coordenada por coordenada, WeasyPrint renderiza un template de Django directamente a PDF. Esto permite reutilizar los estilos de tu marca y la l칩gica de tus templates existentes, asegurando consistencia visual entre la versi칩n web y la versi칩n impresa de tus documentos.
                </p>

                <!-- 7. EXPORTACION DATOS -->
                <h2 id="exportacion" class="text-3xl border-b pb-2">7. Exportaci칩n Masiva (Excel/CSV)</h2>
                <p>
                    Los analistas de negocio frecuentemente necesitan exportar datos crudos para manipularlos en Excel. Cuando la base de datos crece, generar un archivo con 100,000 filas puede consumir toda la memoria RAM del servidor y causar un error de "Timeout". La soluci칩n es utilizar `StreamingHttpResponse`. Esta clase especial de respuesta HTTP permite a Django enviar los datos al navegador en peque침os "chunks" o fragmentos a medida que se generan, en lugar de esperar a que todo el archivo se construya en memoria. Utilizando la librer칤a `csv` de Python o generadores personalizados, podemos iterar sobre un QuerySet masivo y escribir l칤nea por l칤nea en el stream de respuesta, manteniendo el uso de memoria bajo y constante, independientemente del tama침o del dataset.
                </p>

                <!-- 8. CACHE -->
                <h2 id="cache" class="text-3xl border-b pb-2">8. Estrategias de Cach칠 de Vistas y Fragmentos</h2>
                <p>
                    Un dashboard en tiempo real es ideal, pero costoso. Calcular m칠tricas financieras complejas cada vez que un usuario recarga la p치gina puede tumbar la base de datos. La estrategia de cach칠 es vital. Django ofrece cach칠 a varios niveles: cach칠 de sitio completo, cach칠 por vista y, lo m치s 칰til para dashboards, <strong>cach칠 de fragmentos</strong>. Usando el template tag `{% cache 600 'nombre_widget' %}`, podemos almacenar el resultado HTML de un widget costoso (ej. "Ventas por Regi칩n") en Redis o Memcached por 10 minutos. El resto de la p치gina se renderiza din치micamente, pero esa secci칩n pesada se sirve desde la memoria RAM instant치neamente. Es crucial definir estrategias de invalidaci칩n de cach칠 correctas para que los usuarios no vean datos obsoletos cuando realmente importa.
                </p>

                <!-- 9. SEGURIDAD MULTITENANT -->
                <h2 id="seguridad" class="text-3xl border-b pb-2">9. Seguridad y Permisos a Nivel de Objeto</h2>
                <p>
                    En sistemas ERP SaaS (Software as a Service) o grandes corporaciones, es imperativo que un gerente de ventas de la "Regi칩n Norte" no vea los datos de la "Regi칩n Sur". El decorador `@login_required` no es suficiente. Necesitamos implementar seguridad a nivel de fila (Row-Level Security). Esto se logra a menudo sobrescribiendo el m칠todo `get_queryset` en las vistas gen칠ricas para filtrar autom치ticamente los datos seg칰n el usuario autenticado (`return Venta.objects.filter(region=self.request.user.region)`). Adem치s, librer칤as como `django-guardian` permiten asignar permisos espec칤ficos ("puede_ver_reporte_financiero") a usuarios o grupos sobre instancias concretas de modelos, ofreciendo una granularidad de control de acceso mucho m치s fina que el sistema de permisos por defecto de Django.
                </p>

                <!-- 10. UI/UX HIGH DENSITY -->
                <h2 id="ui-ux" class="text-3xl border-b pb-2">10. Dise침o UI/UX para Alta Densidad de Datos</h2>
                <p>
                    El dise침o de interfaces para aplicaciones empresariales difiere radicalmente del dise침o de sitios de marketing. El objetivo es la eficiencia y la densidad de informaci칩n. Utilizar frameworks CSS como <strong>Tailwind CSS</strong> facilita la creaci칩n de layouts complejos con CSS Grid que se adaptan a diferentes tama침os de pantalla. Es importante priorizar la legibilidad: usar fuentes monoespaciadas para tablas num칠ricas (para alinear decimales), colores sem치nticos (rojo para p칠rdidas, verde para ganancias) y evitar el "ruido visual" innecesario. Un buen dashboard debe permitir al usuario escanear r치pidamente los KPIs principales en la parte superior y profundizar en los detalles mediante tablas y filtros en la parte inferior, siguiendo el patr칩n de dise침o "Overview first, zoom and filter, then details-on-demand".
                </p>

            </main>

            <footer class="mt-12 pt-6 border-t border-gray-200 text-center text-gray-500 text-sm">
                <p>&copy; 2024 Gu칤a Definitiva de Django. Dashboard ERP.</p>
            </footer>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/main.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
</body>
</html>