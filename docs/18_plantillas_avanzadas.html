<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>18. Plantillas Avanzadas - Gu칤a Django</title>
    <meta name="description" content="Domina el Motor de Plantillas de Django (DTL): Herencia avanzada, Tags personalizados, Integraci칩n con Alpine.js, i18n y Accesibilidad.">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com?plugins=typography,forms"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        brand: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            900: '#1e3a8a',
                        }
                    }
                }
            }
        }
    </script>

    <!-- PrismJS for Syntax Highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />

    <style>
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #1f2937; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #374151; border-radius: 3px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #4b5563; }
        pre[class*="language-"] { border-radius: 0.5rem; margin: 1.5rem 0; }

        /* Custom Panels */
        .deep-dive { border-left: 4px solid #8b5cf6; padding-left: 1.5rem; margin-top: 2rem; margin-bottom: 2rem; background-color: rgba(139, 92, 246, 0.05); padding: 1.5rem; border-radius: 0 0.5rem 0.5rem 0; }
        .security-alert { border-left: 4px solid #ef4444; background-color: rgba(239, 68, 68, 0.1); padding: 1rem; border-radius: 0.5rem; }
        .pro-tip { border-left: 4px solid #10b981; background-color: rgba(16, 185, 129, 0.1); padding: 1rem; border-radius: 0.5rem; }
        .architecture-note { border-left: 4px solid #f59e0b; background-color: rgba(245, 158, 11, 0.1); padding: 1rem; border-radius: 0.5rem; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 antialiased dark:bg-gray-900 dark:text-gray-100">

    <!-- Mobile Header -->
    <div class="lg:hidden flex items-center justify-between p-4 bg-gray-900 text-white sticky top-0 z-50 shadow-md">
        <span class="font-bold text-lg">Django Gu칤a</span>
        <button id="mobile-menu-toggle" class="p-2 focus:outline-none">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
            </svg>
        </button>
    </div>

    <!-- Sidebar Overlay (Mobile) -->
    <div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden lg:hidden transition-opacity"></div>

    <!-- Sidebar -->
    <aside id="default-sidebar" class="fixed top-0 left-0 z-40 w-64 h-screen transition-transform -translate-x-full lg:translate-x-0 bg-gray-900 border-r border-gray-800" aria-label="Sidebar">
        <div class="h-full flex flex-col">
            <div class="p-6 border-b border-gray-800">
                <a href="index.html" class="flex items-center space-x-3 rtl:space-x-reverse">
                    <span class="self-center text-xl font-bold whitespace-nowrap text-white">Django Gu칤a</span>
                </a>
                <p class="text-xs text-gray-500 mt-2">Dominando el framework web para perfeccionistas.</p>
            </div>
            <div class="px-3 py-4 overflow-y-auto flex-1 custom-scrollbar" id="sidebar-content">
                <!-- Javascript will inject menu here -->
            </div>
            <div class="p-4 border-t border-gray-800">
                <a href="https://github.com/RchrdMrtnz/Guia_de_Aprendizaje_de_Django" target="_blank" class="flex items-center p-2 text-gray-400 rounded-lg hover:text-white hover:bg-gray-800 group transition-colors">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd"></path></svg>
                    <span class="ml-3 text-sm">Ver en GitHub</span>
                </a>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <div class="p-4 lg:ml-64 min-h-screen">
        <div class="p-4 lg:p-8 max-w-5xl mx-auto">
            <main class="prose prose-slate prose-lg max-w-none prose-headings:text-gray-900 dark:prose-headings:text-gray-100 dark:prose-p:text-gray-300 dark:prose-strong:text-white dark:prose-li:text-gray-300 prose-a:text-blue-600 hover:prose-a:text-blue-800 prose-pre:bg-gray-800 prose-pre:shadow-lg rounded-xl">

                <h1 class="text-4xl font-extrabold mb-8 text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-pink-500">
                    18. Plantillas Avanzadas: Dominando el Frontend en Django
                </h1>

                <p class="lead text-xl text-gray-600 dark:text-gray-400">
                    El sistema de plantillas de Django (DTL) es mucho m치s poderoso de lo que parece a primera vista. Lejos de ser un simple reemplazo de strings, es un motor extensible que te permite construir interfaces complejas, reutilizables y altamente mantenibles. En este cap칤tulo exploraremos c칩mo llevar tus templates al siguiente nivel, integrando interactividad moderna sin abandonar la filosof칤a "Batteries Included" de Django.
                </p>

                <!-- INDICE RAPIDO -->
                <div class="bg-gray-100 dark:bg-gray-800 p-6 rounded-lg my-8 border border-gray-200 dark:border-gray-700">
                    <h3 class="mt-0 mb-4 text-sm font-bold uppercase tracking-wide text-gray-500">Contenido del Cap칤tulo</h3>
                    <ul class="grid grid-cols-1 md:grid-cols-2 gap-2 text-sm">
                        <li><a href="#herencia" class="no-underline hover:text-blue-600">游댳 1. Herencia Profunda (Extends)</a></li>
                        <li><a href="#componentes" class="no-underline hover:text-blue-600">游댳 2. Componentes Reutilizables (Include)</a></li>
                        <li><a href="#custom-tags" class="no-underline hover:text-blue-600">游댳 3. Custom Template Tags</a></li>
                        <li><a href="#custom-filters" class="no-underline hover:text-blue-600">游댳 4. Custom Filters (Formato)</a></li>
                        <li><a href="#context-processors" class="no-underline hover:text-blue-600">游댳 5. Context Processors Globales</a></li>
                        <li><a href="#alpinejs" class="no-underline hover:text-blue-600">游댳 6. Integraci칩n con Alpine.js</a></li>
                        <li><a href="#formularios" class="no-underline hover:text-blue-600">游댳 7. Manejo Avanzado de Formularios</a></li>
                        <li><a href="#i18n" class="no-underline hover:text-blue-600">游댳 8. Internacionalizaci칩n (i18n)</a></li>
                        <li><a href="#debug" class="no-underline hover:text-blue-600">游댳 9. Depuraci칩n y Optimizaci칩n</a></li>
                        <li><a href="#a11y" class="no-underline hover:text-blue-600">游댳 10. Accesibilidad (A11y)</a></li>
                    </ul>
                </div>

                <!-- 1. HERENCIA -->
                <h2 id="herencia" class="text-3xl border-b pb-2">1. Herencia de Plantillas (Extends/Blocks)</h2>
                <p>
                    La herencia es la piedra angular del dise침o DRY (Don't Repeat Yourself) en Django. Sin embargo, muchos desarrolladores se limitan a un simple <code>base.html</code>. En proyectos grandes, es com칰n tener m칰ltiples niveles de herencia: <code>base.html</code> (estructura global), <code>dashboard_base.html</code> (layout espec칤fico para admin con sidebar), y finalmente <code>analytics.html</code> (contenido espec칤fico). Es fundamental dominar el uso de <code>{{ block.super }}</code>. Esta variable permite inyectar contenido en un bloque definido en el padre sin sobrescribirlo completamente, ideal para a침adir hojas de estilo CSS o scripts JS espec칤ficos de una p치gina sin perder los assets globales cargados en la plantilla base. Planificar correctamente tus bloques (<code>{% block title %}</code>, <code>{% block content %}</code>, <code>{% block extra_js %}</code>) desde el inicio te ahorrar치 horas de refactorizaci칩n.
                </p>

                <!-- 2. COMPONENTES -->
                <h2 id="componentes" class="text-3xl border-b pb-2">2. Componentes Reutilizables (Include/With)</h2>
                <p>
                    Antes de que React popularizara el concepto de componentes, Django ya lo permit칤a con la etiqueta <code>{% include %}</code>. Para evitar repetir c칩digo HTML como tarjetas de producto, alertas o modales, extrae ese c칩digo a un archivo parcial (ej. <code>_product_card.html</code>). Lo que hace esta t칠cnica verdaderamente poderosa es el uso de <code>with</code>. Puedes pasar variables locales al componente, aisl치ndolo del contexto global y haci칠ndolo m치s robusto. Por ejemplo: <code>{% include "components/alert.html" with type="danger" message="Error cr칤tico" %}</code>. Esto transforma tus templates en un sistema de ensamblaje de piezas prefabricadas, mejorando la consistencia visual y facilitando el mantenimiento. Si necesitas slots o contenido transclusivo, librer칤as como <code>django-components</code> o <code>slippers</code> pueden extender esta funcionalidad nativa.
                </p>

                <!-- 3. CUSTOM TAGS -->
                <h2 id="custom-tags" class="text-3xl border-b pb-2">3. Custom Template Tags (Simple Tag)</h2>
                <p>
                    A veces necesitas l칩gica de presentaci칩n que es demasiado compleja para la vista pero que no pertenece al modelo. Los <strong>Custom Template Tags</strong> son la soluci칩n. Un <code>simple_tag</code> es una funci칩n Python que retorna un string para ser inyectado en el HTML. Son perfectos para generar URLs din치micas complejas, calcular estados visuales (como insignias de "Nuevo" basadas en fechas), o inyectar configuraciones de frontend. Se almacenan en el directorio <code>templatetags</code> de tu aplicaci칩n y se cargan con <code>{% load mi_tag %}</code>. A diferencia de los filtros, los tags pueden recibir m칰ltiples argumentos y acceder al contexto de la plantilla si se define <code>takes_context=True</code>, lo que les da acceso al objeto <code>request</code> o al usuario actual sin pasarlos expl칤citamente.
                </p>
                <pre><code class="language-python">@register.simple_tag(takes_context=True)
def user_theme(context):
    request = context['request']
    return request.COOKIES.get('theme', 'light')
</code></pre>

                <!-- 4. CUSTOM FILTERS -->
                <h2 id="custom-filters" class="text-3xl border-b pb-2">4. Custom Filters (Formato de Datos)</h2>
                <p>
                    Los filtros modifican la visualizaci칩n de una variable: <code>{{ fecha|date:"Y-m-d" }}</code>. Crear tus propios filtros es esencial para formatear datos espec칤ficos de tu dominio. Por ejemplo, un filtro <code>|phone_number</code> que formatea un string crudo "5551234567" a "(555) 123-4567", o un filtro <code>|markdown</code> que convierte texto plano en HTML seguro. Los filtros deben ser idempotentes y libres de efectos secundarios. Es una buena pr치ctica manejar excepciones silenciosamente dentro del filtro para evitar que un error de formato rompa toda la p치gina (Error 500). Recuerda siempre usar <code>mark_safe</code> con extrema precauci칩n si tu filtro retorna HTML, para evitar vulnerabilidades XSS.
                </p>

                <!-- 5. CONTEXT PROCESSORS -->
                <h2 id="context-processors" class="text-3xl border-b pb-2">5. Context Processors (Variables Globales)</h2>
                <p>
                    쯊e encuentras pasando la misma variable (como el a침o actual para el footer, o el n칰mero de notificaciones no le칤das) en cada vista usando <code>render</code>? Los <strong>Context Processors</strong> resuelven esto inyectando variables en el contexto de <em>todas</em> las plantillas autom치ticamente. Son simples funciones que reciben el objeto <code>request</code> y retornan un diccionario. Se configuran en <code>settings.py</code> bajo la clave <code>context_processors</code>. Son ideales para exponer configuraciones del sitio (<code>SITE_NAME</code>, <code>SUPPORT_EMAIL</code>), men칰s de navegaci칩n din치micos o informaci칩n del carrito de compras en un e-commerce. Sin embargo, 칰salos con moderaci칩n: ejecutar consultas pesadas de base de datos en un context processor ralentizar치 cada p치gina de tu sitio.
                </p>

                <!-- 6. ALPINE.JS -->
                <h2 id="alpinejs" class="text-3xl border-b pb-2">6. Integraci칩n Frontend Ligera (Alpine.js)</h2>
                <p>
                    Django es fant치stico en el backend, pero el HTML est치tico a veces no es suficiente para la UX moderna. <strong>Alpine.js</strong> se ha convertido en el compa침ero perfecto para Django Templates. Ofrece la reactividad de Vue/React (mostrar/ocultar elementos, two-way binding) pero directamente en el HTML, sin necesidad de compilaci칩n (npm/webpack). Puedes usar variables de plantilla de Django para inicializar el estado de Alpine: <code>&lt;div x-data="{ open: {{ is_open|yesno:'true,false' }} }"&gt;</code>. Esto permite crear dropdowns, modales, tabs y validaciones de formulario en tiempo real manteniendo la simplicidad de tu stack tecnol칩gico y evitando la complejidad de una Single Page Application (SPA) completa cuando no es necesaria.
                </p>

                <!-- 7. FORMULARIOS WIDGETS -->
                <h2 id="formularios" class="text-3xl border-b pb-2">7. Manejo Avanzado de Formularios y Widgets</h2>
                <p>
                    Renderizar formularios con <code>{{ form.as_p }}</code> es r치pido pero raramente produce el dise침o deseado. Para tener control total, puedes iterar sobre los campos del formulario manualmente: <code>{% for field in form %}</code>. A칰n mejor es usar la librer칤a <code>django-widget-tweaks</code>, que permite a침adir clases CSS y atributos HTML directamente en la plantilla sin modificar el c칩digo Python del formulario. <code>{% render_field form.email class="form-input border-red-500" placeholder="tu@email.com" %}</code>. Esto es crucial para integrar frameworks CSS como Tailwind o Bootstrap, donde las clases de utilidad deben aplicarse directamente a los inputs. Adem치s, manejar correctamente la visualizaci칩n de errores (<code>field.errors</code>) y la ayuda (<code>field.help_text</code>) es vital para una buena experiencia de usuario.
                </p>

                <!-- 8. I18N -->
                <h2 id="i18n" class="text-3xl border-b pb-2">8. Internacionalizaci칩n (i18n) en Templates</h2>
                <p>
                    Si tu aplicaci칩n apunta a una audiencia global, no puedes "quemar" (hardcode) los textos en el HTML. Django posee un robusto sistema de internacionalizaci칩n. En las plantillas, utiliza el tag <code>{% trans "Bienvenido" %}</code> para textos simples y <code>{% blocktrans %}...{% endblocktrans %}</code> para oraciones complejas que incluyen variables interpoladas. Django extraer치 estos textos a archivos <code>.po</code> donde traductores pueden trabajar. Es importante recordar que el formato de fechas, n칰meros y monedas tambi칠n var칤a por regi칩n; utiliza los filtros <code>|localize</code> y tags como <code>{% get_current_language %}</code> para adaptar la interfaz. Un sitio verdaderamente profesional respeta la configuraci칩n regional del usuario autom치ticamente.
                </p>

                <!-- 9. DEBUG Y OPTIMIZACION -->
                <h2 id="debug" class="text-3xl border-b pb-2">9. Depuraci칩n y Optimizaci칩n (Debug Toolbar)</h2>
                <p>
                    Cuando una p치gina carga lento, a menudo el culpable es la renderizaci칩n de la plantilla, no solo la consulta SQL. <strong>Django Debug Toolbar</strong> es la herramienta est치ndar para diagnosticar esto. Su panel "Templates" muestra exactamente qu칠 plantillas se cargaron, la jerarqu칤a de herencia y los valores del contexto. M치s importante a칰n, el panel "SQL" te permite detectar consultas duplicadas generadas dentro de bucles en la plantilla (el problema N+1). Optimizar implica mover l칩gica pesada fuera de los tags, usar <code>{% cache %}</code> para fragmentos est치ticos y asegurarse de que los filtros personalizados sean eficientes. Nunca asumas d칩nde est치 el cuello de botella; m칤delo con herramientas de perfilado.
                </p>

                <!-- 10. ACCESIBILIDAD A11Y -->
                <h2 id="a11y" class="text-3xl border-b pb-2">10. Accesibilidad (A11y) y Sem치ntica HTML</h2>
                <p>
                    Una plantilla avanzada no es solo visualmente atractiva, es accesible para todos, incluyendo usuarios que utilizan lectores de pantalla. Esto comienza con HTML sem치ntico: usar <code>&lt;nav&gt;</code>, <code>&lt;main&gt;</code>, <code>&lt;article&gt;</code>, <code>&lt;aside&gt;</code> en lugar de <code>&lt;div&gt;</code> gen칠ricos. En Django, aseg칰rate de que tus formularios rendericen etiquetas <code>&lt;label&gt;</code> correctamente asociadas a sus inputs mediante <code>for="{{ field.id_for_label }}"</code>. Utiliza atributos ARIA din치micos cuando integres JavaScript (ej. <code>aria-expanded="true/false"</code> en men칰s desplegables). La accesibilidad no es una "feature" extra, es un requerimiento legal en muchos pa칤ses y una mejor pr치ctica 칠tica. Validar tus plantillas con herramientas como Lighthouse o WAVE debe ser parte de tu flujo de trabajo de desarrollo frontend.
                </p>

            </main>

            <footer class="mt-12 pt-6 border-t border-gray-200 text-center text-gray-500 text-sm">
                <p>&copy; 2024 Gu칤a Definitiva de Django. Plantillas Avanzadas.</p>
            </footer>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/main.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
</body>
</html>